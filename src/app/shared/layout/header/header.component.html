<header role="banner" *ngIf="this.isHandset$ | async as isHandset">
  <mat-toolbar color="primary">
    <mat-toolbar-row>
      <a class="title-bar-link" [routerLink]="['/']">
        <mat-icon class="icon-margin-right">watch</mat-icon>
        <span class="toolbar-title">KS Web Scraper</span>
      </a>
      <span class="spacer"></span>
      <!-- TODO: Byt ut till separata komponenter? -->
      <div *ngIf="isHandset.matches; else largeMenu">
        <!-- Start hamburgarmeny -->
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
          <mat-icon>menu</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <div class="hamburger-toolbar-wrapper">
            <!-- $event.stopPropagation förhindrar att menyn stängs vid klick -->
            <button
              mat-menu-item
              (click)="$event.stopPropagation()"
              matTooltip="Toggle theme"
              matTooltipPosition="left">
              <mat-slide-toggle (click)="toggleTheme()" color="primary" [(ngModel)]="isDarkMode">
                Dark mode
                <mat-icon class="dark-mode-icons" fontSet="material-icons-outlined"> dark_mode </mat-icon>
              </mat-slide-toggle>
            </button>
            <button mat-menu-item *ngIf="(apiStatus$ | async)?.active as active; else hamburgerApiNotActive">
              <div
                matTooltip="View API statistics"
                matTooltipPosition="left"
                (click)="active ? openApiStatusDialog() : ''">
                <mat-icon class="status-icon" color="primary"> check_circle_outline </mat-icon>
                <span class="status-text">API Status</span>
              </div>
            </button>
            <!-- API:et är inte aktivt. Länken ska vara inaktiverad  -->
            <ng-template #hamburgerApiNotActive>
              <button mat-menu-item disabled>
                <div matTooltip="API is not active" matTooltipPosition="left" class="api-inactive">
                  <mat-icon class="status-icon offline" color="primary"> highlight_off </mat-icon>
                  <span class="status-text">API Status</span>
                </div>
              </button>
            </ng-template>
          </div>
        </mat-menu>
      </div>
      <!-- Start "vanlig" meny -->
      <ng-template #largeMenu>
        <!-- TODO: Går det att byta till select med dark-mode? -->
        <div [ngClass]="isDarkMode ? 'header-chip-wrapper-dark' : 'header-chip-wrapper-light'">
          <div class="header-chip pointer" matTooltip="Toggle theme" (click)="toggleTheme()">
            <mat-slide-toggle color="accent" [checked]="isDarkMode">
              Dark mode
              <mat-icon class="dark-mode-icons" fontSet="material-icons-outlined"> dark_mode </mat-icon>
            </mat-slide-toggle>
          </div>
          <div
            *ngIf="(apiStatus$ | async)?.active as active; else apiNotActive"
            (click)="active ? openApiStatusDialog() : ''"
            class="header-chip pointer"
            matTooltip="View API statistics">
            <!-- API:et är aktivt. -->
            <div class="api-active">
              <mat-icon class="status-icon" color="primary"> check_circle_outline </mat-icon>
              <span class="status-text">API Status</span>
            </div>
          </div>
          <!-- API:et är INTE aktivt. -->
          <ng-template #apiNotActive>
            <div class="header-chip">
              <div class="api-inactive" matTooltip="API is not active">
                <mat-icon class="status-icon offline" color="primary"> highlight_off </mat-icon>
                <span class="status-text">API Status</span>
              </div>
            </div>
          </ng-template>
        </div>
      </ng-template>
    </mat-toolbar-row>
  </mat-toolbar>
</header>
